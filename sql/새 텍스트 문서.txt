--○ 8일차 
-- 1번
SELECT DEPTNO
     , JOB
     , SUM(SAL) SUM_SAL
FROM EMP
WHERE DEPTNO IS NOT NULL
GROUP BY ROLLUP(DEPTNO, JOB)
ORDER BY DEPTNO;

-- 2번
SELECT DEPTNO
     , JOB
     , SUM(SAL) SUM_SAL
FROM EMP
WHERE DEPTNO IS NOT NULL
GROUP BY CUBE(DEPTNO, JOB);

-- 3번
SELECT CASE WHEN GROUPING(T.DNAME) = 1 THEN '합계'
            ELSE T.DNAME
            END DNAME
     , CASE WHEN GROUPING_ID(T.DNAME, T.JOB) = 1 THEN '소계'
            WHEN GROUPING_ID(T.DNAME, T.JOB) = 0 THEN T.JOB
            ELSE ' '
            END JOB
     , SUM(T.SAL) AS SUM_SAL
FROM
(
    SELECT E.*, D.DNAME
    FROM EMP E JOIN DEPT D ON E.DEPTNO = D.DEPTNO
) T
GROUP BY ROLLUP( T.DNAME, T.JOB)
ORDER BY GROUPING(T.DNAME), DNAME DESC, GROUPING(T.JOB);

-- 4번
SELECT CASE WHEN R.RANK = 1 THEN R.DNAME
            ELSE ' '
            END DNAME
     , R.JOB, R.SUM_SAL
FROM
(
    SELECT CASE WHEN GROUPING(T.DNAME) = 1 THEN '합계'
                ELSE T.DNAME
                END DNAME
         , CASE WHEN GROUPING_ID(T.DNAME, T.JOB) = 1 THEN '소계'
                WHEN GROUPING_ID(T.DNAME, T.JOB) = 0 THEN T.JOB
                ELSE ' '
                END JOB
         , REGEXP_REPLACE(REVERSE(
                REGEXP_REPLACE(REVERSE(TO_CHAR(SUM(T.SAL))), '(\d{3})', '\1,'))
                , '^,', '') AS SUM_SAL
         , RANK() OVER (PARTITION BY T.DNAME ORDER BY T.JOB) RANK
    FROM
    (
        SELECT E.*, D.DNAME
        FROM EMP E JOIN DEPT D ON E.DEPTNO = D.DEPTNO
    ) T
    GROUP BY ROLLUP( T.DNAME, T.JOB)
    ORDER BY GROUPING(T.DNAME), DNAME, GROUPING(T.JOB), JOB
) R;

-- 5번
SELECT CASE WHEN T2.RANK = 1 THEN T2.DNAME
            ELSE ' '
            END DNAME
     , T2.JOB, T2.SUM_SAL
FROM
(
    SELECT CASE WHEN GROUPING(T1.DNAME) = 1 THEN '합계'
                    ELSE T1.DNAME
                    END DNAME
         , CASE WHEN GROUPING_ID(T1.DNAME, T1.JOB) = 1 THEN '소계'
                    WHEN GROUPING_ID(T1.DNAME, T1.JOB) = 0 THEN T1.JOB
                    ELSE ' '
                    END JOB
         , REGEXP_REPLACE(REVERSE(
                REGEXP_REPLACE(REVERSE(TO_CHAR(SUM(T1.SAL))), '(\d{3})', '\1,'))
                , '^,', '') AS SUM_SAL
         , RANK() OVER (PARTITION BY T1.DNAME ORDER BY T1.JOB) RANK
    FROM
    (
        SELECT D.DNAME, E.JOB, SUM(E.SAL) AS SAL
        FROM EMP E JOIN DEPT D ON E.DEPTNO = D.DEPTNO
        GROUP BY D.DNAME, E.JOB
    ) T1
    WHERE T1.SAL >= 1000
    GROUP BY ROLLUP(T1.DNAME, T1.JOB)
    ORDER BY GROUPING(T1.DNAME), T1.DNAME, GROUPING(T1.JOB), T1.JOB
) T2;